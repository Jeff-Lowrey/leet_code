{% extends "base.html" %}

{% block title %}{{ problem_name }} - LeetCode Solution{% endblock %}

{% block extra_head %}
<style>
    {{ style }}

    /* Force all sections to stay within container */
    .container > * {
        max-width: 100% !important;
        box-sizing: border-box !important;
    }

    .page-header,
    .problem-statement,
    .solution-explanation,
    .skeleton-code,
    .solution-code,
    .navigation {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        overflow: hidden !important;
    }

    .skeleton-code details,
    .solution-code details {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        overflow: hidden !important;
    }

    .code-content {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        overflow: hidden !important;
    }

    .highlight {
        border-radius: 8px;
        padding: 1rem;
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        overflow-x: auto !important;
    }

    .highlight table,
    .highlight .highlighttable {
        table-layout: fixed !important;
        width: 100% !important;
        max-width: 100% !important;
        display: table !important;
        border-collapse: collapse !important;
    }

    .highlight .highlighttable tr,
    .highlight .highlighttable td {
        max-width: 100% !important;
    }

    .highlight .highlighttable td.linenos {
        width: 3em !important;
        min-width: 3em !important;
        max-width: 3em !important;
    }

    .highlight .highlighttable td.code {
        width: calc(100% - 3em) !important;
        max-width: calc(100% - 3em) !important;
        overflow-x: auto !important;
    }

    .highlight .linenos {
        width: 3em !important;
    }

    .highlight td.code {
        overflow-x: auto !important;
        word-wrap: break-word;
    }

    .highlight pre {
        max-width: 100% !important;
        overflow-x: auto !important;
        white-space: pre !important;
        word-wrap: normal !important;
    }
</style>
<script src="{{ url_for('static', filename='js/pages/solution.js') }}"></script>
{% endblock %}

{% block content %}
<header class="page-header" data-category="{{ category }}">
    <nav class="breadcrumb">
        <a href="/">Home</a> /
        <a href="{{ url_for('category_view', category=category) }}">{{ category_name }}</a> /
        <span>{{ problem_name }}</span>
    </nav>
    <h1>
        {% if problem_number %}
        <span class="problem-number">#{{ problem_number }}</span>
        {% endif %}
        {{ problem_name }}
    </h1>

    <!-- Difficulty and Complexity Badges -->
    <div class="solution-badges">
        {% if difficulty %}
        <a href="{{ url_for('difficulty_overview') }}#{{ difficulty.lower() }}" class="badge difficulty-badge difficulty-{{ difficulty.lower() }}">
            {{ difficulty }}
        </a>
        {% endif %}
        {% if time_complexity or space_complexity %}
        <a href="{{ url_for('complexity_overview') }}#{{ (time_complexity or 'Unknown') }}_{{ (space_complexity or 'Unknown') }}" class="badge complexity-badge">
            {% if time_complexity %}Time: {{ time_complexity }}{% endif %}{% if time_complexity and space_complexity %} | {% endif %}{% if space_complexity %}Space: {{ space_complexity }}{% endif %}
        </a>
        {% endif %}
    </div>

    <!-- Download and format options -->
    <div class="solution-actions">
        <div class="format-options">
            {% if not is_leetcode_format %}
            <a href="{{ url_for('solution_leetcode_view', category=category, filename=filename) }}" class="btn btn-secondary">View LeetCode Format</a>
            {% else %}
            <a href="{{ url_for('solution_view', category=category, filename=filename) }}" class="btn btn-secondary">View Original Format</a>
            {% endif %}
            <a href="{{ url_for('upload_alternative_solution', category=category, filename=filename) }}" class="btn btn-secondary">Upload Solution</a>
        </div>
        <div class="download-options">
            <span class="download-label">Download{% if current_language %} ({{ current_language }}){% endif %}:</span>
            <a href="{{ url_for('download_solution', category=category, filename=filename, format='skeleton', language=current_language or 'Python') }}" class="btn btn-small">Skeleton</a>
            <a href="{{ url_for('download_solution', category=category, filename=filename, format='solution', language=current_language or 'Python') }}" class="btn btn-small">Solution</a>
            {% if not current_language or current_language == 'Python' %}
            <a href="{{ url_for('download_solution', category=category, filename=filename, format='leetcode', language='Python') }}" class="btn btn-small">LeetCode</a>
            {% endif %}
            <a href="{{ url_for('download_solution', category=category, filename=filename, format='both', language=current_language or 'Python') }}" class="btn btn-primary btn-small">All (ZIP)</a>
        </div>
    </div>

    <!-- Language selector if multiple languages available -->
    {% if available_languages and available_languages|length > 1 %}
    <div class="language-selector">
        <div class="language-info">
            <span class="language-label">Available Languages:</span>
            <span class="available-languages">{{ available_languages|join(', ') }}</span>
        </div>
        <div class="language-dropdown">
            <label for="language-select" class="dropdown-label">Choose Language:</label>
            <select id="language-select" class="language-select" onchange="switchLanguage(this.value)">
                {% for lang in available_languages %}
                    {% if lang == 'Python' %}
                        <option value="{{ url_for('solution_view', category=category, filename=filename) }}"
                                {% if not current_language or current_language == 'Python' %}selected{% endif %}>
                            {{ lang }}
                        </option>
                    {% else %}
                        <option value="{{ url_for('view_alternative_solution', category=category, filename=filename, language=lang) }}"
                                {% if current_language == lang %}selected{% endif %}>
                            {{ lang }}
                        </option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
    </div>
    {% endif %}
</header>

<!-- Problem Statement Section (Non-collapsible) -->
{% if problem_description %}
<section class="problem-statement" data-category="{{ category }}">
    <h2>Problem Statement</h2>
    <div class="problem-content">
        {{ problem_description|safe }}
    </div>
</section>
{% endif %}

{% if explanation %}
<section class="solution-explanation">

    {% if explanation.intuition %}
    <details>
        <summary>Intuition</summary>
        <div class="explanation-content">
            {{ explanation.intuition|safe }}
        </div>
    </details>
    {% endif %}

    {% if explanation.key_insight %}
    <details>
        <summary>Key Insight</summary>
        <div class="explanation-content">
            {{ explanation.key_insight|safe }}
        </div>
    </details>
    {% endif %}

    {% if explanation.approach %}
    <details>
        <summary>Approach</summary>
        <div class="explanation-content">
            {{ explanation.approach|safe }}
        </div>
    </details>
    {% endif %}

    {% if explanation.algorithm %}
    <details>
        <summary>Algorithm</summary>
        <div class="explanation-content">
            {{ explanation.algorithm|safe }}
        </div>
    </details>
    {% endif %}

    {% if explanation.why_this_works %}
    <details>
        <summary>Why This Works</summary>
        <div class="explanation-content">
            {{ explanation.why_this_works|safe }}
        </div>
    </details>
    {% endif %}

    {% if explanation.example %}
    <details>
        <summary>Example Walkthrough</summary>
        <div class="explanation-content">
            {{ explanation.example|safe }}
        </div>
    </details>
    {% endif %}

    {% if explanation.edge_cases %}
    <details>
        <summary>Edge Cases</summary>
        <div class="explanation-content">
            {{ explanation.edge_cases|safe }}
        </div>
    </details>
    {% endif %}

    {% if explanation.complexity %}
    <details>
        <summary>Complexity Analysis</summary>
        <div class="explanation-content">
            {{ explanation.complexity|safe }}
        </div>
    </details>
    {% endif %}

    {% if explanation.additional_notes %}
    <details>
        <summary>Additional Notes</summary>
        <div class="explanation-content">
            {{ explanation.additional_notes|safe }}
        </div>
    </details>
    {% endif %}

    {% if explanation.optimizations %}
    <details>
        <summary>Optimizations</summary>
        <div class="explanation-content">
            {{ explanation.optimizations|safe }}
        </div>
    </details>
    {% endif %}

    {% if explanation.alternatives %}
    <details>
        <summary>Alternative Approaches</summary>
        <div class="explanation-content">
            {{ explanation.alternatives|safe }}
        </div>
    </details>
    {% endif %}

</section>
{% endif %}

<!-- Skeleton Code Section (Collapsible) -->
{% if skeleton_code %}
<section class="skeleton-code">
    <details>
        <summary>Skeleton Code</summary>
        <div class="code-content">
            {{ skeleton_code|safe }}
        </div>
    </details>
</section>
{% endif %}

<!-- Solution Code Section (Collapsible) -->
<section class="solution-code">
    <details>
        <summary>Solution Code</summary>
        <div class="code-content">
            {{ code|safe }}
        </div>
    </details>
</section>

<section class="navigation">
    <a href="{{ url_for('category_view', category=category) }}" class="btn">‚Üê Back to {{ category_name }}</a>
</section>
{% endblock %}